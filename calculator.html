<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Mortar Calculator</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg:#121212; --panel:#1c1c1c; --text:#eee; --muted:#777; --accent:#333; 
  --card-radius:8px; --input-radius:6px; --button-radius:8px;
}
body{
  background:var(--bg);
  color:var(--text);
  font-family: Inter, Arial, sans-serif;
  margin:12px;
  font-size:1rem;
}
.card{
  background:var(--panel);
  border-radius:var(--card-radius);
  padding:16px;
  max-width:1000px;
  margin:0 auto 12px;
  box-shadow:0 6px 16px rgba(0,0,0,0.5);
}
h2,h3{margin:0 0 6px; font-size:1.2rem;}
label{margin:4px 0 4px; font-size:0.95rem;}
input,select,button{font-size:1rem; border-radius:var(--input-radius); padding:8px; background:#222; color:#eee; border:1px solid #444;}
button{background:#333; color:#eee; font-weight:600; cursor:pointer; border-radius:var(--button-radius);}
.row{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
.col{flex:1;}
#output,#spreadOutput,#totOutput{margin-top:6px;font-weight:600;}
.small{font-size:0.85rem;color:var(--muted);margin-top:4px;}
table{width:100%;border-collapse:collapse;margin-top:6px;font-size:0.85rem;}
th,td{border:1px solid #444;padding:4px;text-align:center;}
th{background:#1a1a1a;}
.switch{position:relative;display:inline-block;width:50px;height:26px;}
.switch input{display:none;}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#444;transition:.3s;border-radius:26px;}
.slider:before{position:absolute;content:"";height:20px;width:20px;left:3px;bottom:3px;background:white;transition:.3s;border-radius:50%;}
input:checked + .slider{background-color:#555;}
input:checked + .slider:before{transform:translateX(24px);}
</style>
</head>
<body>

<div class="card">
  <h2>Mortar Calculator</h2>

  <div class="row" style="justify-content:space-between;">
    <input id="nameInput" type="text" placeholder="Name" style="flex:1; margin-right:8px;">
    <input id="bearingInput" type="number" placeholder="Bearing Â°" style="flex:1; margin-right:8px;">
    <select id="shellSelect" onchange="updateRingsOptions()" style="flex:1; margin-right:8px;">
      <option value="0832DU">0-832DU</option>
      <option value="M821_HE">M821 HE</option>
    </select>
    <select id="ringsSelect" style="flex:1;"></select>
  </div>

  <div class="row" style="justify-content:space-between; margin-top:8px;">
    <input id="rangeInput" type="number" placeholder="Range (m)" style="flex:1; margin-right:8px;">
    <input id="elevDiffInput" type="number" placeholder="Elevation Diff (m)" style="flex:1; margin-right:8px;">
    <input id="spreadManual" type="number" min="0" max="50" value="10" placeholder="Spread m" style="flex:1; margin-right:8px;">
    <button onclick="calculate()" style="flex:1; margin-right:8px;">Calc</button>
    <button onclick="resetView()" style="flex:1;">Reset</button>
  </div>

  <div class="row" style="margin-top:8px; align-items:center; gap:12px;">
    <input id="spreadRange" type="range" min="0" max="20" value="10" oninput="updateSpreadDisplay('slider')" style="flex:2;">
    <div class="small" id="spreadDisplay" style="flex:1;">Spread: 10 m</div>
    <label class="switch" style="flex:none;"><input type="checkbox" id="totToggle"><span class="slider"></span></label>
    <div class="small" style="flex:none;">Enable TOT</div>
  </div>

  <div id="output"></div>
  <div id="spreadOutput"></div>
  <div id="totOutput"></div>
</div>


<div class="card">
<h2>Elevation Difference Calculator</h2>
<div class="row">
  <input id="playerElev" type="number" placeholder="Your Elev (m)" class="col">
  <input id="targetElev" type="number" placeholder="Target Elev (m)" class="col">
  <button onclick="calculateDifference()">Calc Diff</button>
</div>
<div id="elevDiffResult" class="small"></div>
</div>

<div class="card">
<h3>History</h3>
<table id="historyTable">
<thead>
<tr>
<th>Name</th><th>Shell</th><th>Rings</th><th>Range</th><th>Bearing</th><th>Elev Diff</th><th>Corrected</th><th>Del</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>


<script>
/* ---------- ballistic tables (keep your data) ---------- */
const ballisticTables = {
  "0832DU": {
    4:[[400,1418],[500,1398],[600,1376],[700,1355],[800,1333],[900,1311],[1000,1288],[1100,1264],[1200,1240],[1300,1215],[1400,1189],[1500,1161],[1600,1133],[1700,1102],[1800,1069],[1900,1034],[2000,995],[2100,950],[2200,896],[2300,820]],
    3:[[300,1423],[400,1397],[500,1370],[600,1343],[700,1315],[800,1286],[900,1257],[1000,1226],[1100,1193],[1200,1159],[1300,1123],[1400,1084],[1500,1040],[1600,991],[1700,932],[1800,851]],
    2:[[200,1432],[300,1397],[400,1362],[500,1325],[600,1288],[700,1248],[800,1207],[900,1162],[1000,1114],[1100,1060],[1200,997],[1300,914],[1400,755]],
    1:[[100,1446],[200,1392],[300,1335],[400,1275],[500,1212],[600,1141],[700,1058],[800,952]],
    0:[[50,1455],[100,1411],[150,1365],[200,1318],[250,1268],[300,1217],[350,1159],[400,1095],[450,1023],[500,922]]
  },
  "M821_HE": {
    4:[[400,1531],[500,1514],[600,1496],[700,1478],[800,1460],[900,1442],[1000,1424],[1100,1405],[1200,1385],[1400,1346],[1500,1326],[1600,1305],[1700,1283],[1800,1261],[1900,1238],[2000,1214],[2100,1188],[2300,1134],[2400,1104],[2500,1070],[2600,1034],[2700,993],[2800,942],[2900,870]],
    3:[[300,1534],[400,1511],[500,1489],[600,1466],[700,1442],[800,1419],[900,1395],[1000,1370],[1100,1344],[1200,1318],[1300,1291],[1400,1263],[1500,1233],[1600,1202],[1700,1169],[1800,1133],[1900,1094],[2000,1051],[2100,999],[2200,931],[2300,801]],
    2:[[200,1538],[300,1507],[400,1437.5],[500,1443],[600,1410],[700,1376],[800,1341],[900,1305],[1000,1266],[1100,1225],[1200,1180],[1300,1132],[1400,1076],[1500,1009]],
    1:[[100,1547],[200,1492],[300,1437],[400,1378],[500,1317],[600,1249],[700,1174],[800,1085],[900,954]],
    0:[[50,1540],[100,1479],[150,1416],[200,1350],[250,1279],[300,1201],[350,1106],[400,955]]
  }
};

const elevCorrectionTables = {
  "0832DU": {
    4:[[400,10],[500,11],[600,10],[700,11],[800,11],[900,12],[1000,12],[1100,12],[1200,13],[1300,13],[1400,14],[1500,14],[1600,15],[1700,16],[1800,17],[1900,19],[2000,22],[2100,26],[2200,34],[2300,65]],
    3:[[300,13],[400,14],[500,13],[600,14],[700,14],[800,14],[900,16],[1000,16],[1100,16],[1200,18],[1300,19],[1400,22],[1500,24],[1600,28],[1700,36],[1800,68]],
    2:[[200,17],[300,18],[400,18],[500,18],[600,20],[700,20],[800,22],[900,23],[1000,26],[1100,29],[1200,37],[1300,55]],
    1:[[100,27],[200,28],[300,29],[400,31],[500,35],[600,40],[700,48],[800,81]],
    0:[[50,44],[100,46],[150,47],[200,50],[250,51],[300,58],[350,64],[400,72],[450,101]]
  },
  "M821_HE": {
    4:[[400,9],[500,9],[600,9],[700,9],[800,9],[900,9],[1000,10],[1100,10],[1200,9],[1300,10],[1400,10],[1500,11],[1600,11],[1700,11],[1800,11],[1900,12],[2000,12],[2100,13],[2200,14],[2300,15],[2400,17],[2500,17],[2600,20],[2700,25],[2800,31],[2900,64]],
    3:[[300,12],[400,11],[500,12],[600,12],[700,12],[800,12],[900,13],[1000,13],[1100,13],[1200,13],[1300,14],[1400,15],[1600,16],[1700,17],[1800,19],[1900,21],[2000,26],[2100,31],[2200,46]],
    2:[[200,15],[300,16],[400,16],[500,16],[600,16],[700,17],[800,18],[900,20],[1000,20],[1100,22],[1200,23],[1300,27],[1400,31],[1500,43],[1600,109]],
    1:[[100,28],[200,27],[300,29],[400,31],[500,33],[600,35],[700,42],[800,57],[900,148]],
    0:[[50,61],[100,63],[150,66],[200,71],[250,78],[300,95],[350,151]]
  }
};

const tofTables = {
  "0832DU": {
    4:[[400,32.9],[500,32.9],[600,32.8],[700,32.7],[800,32.6],[900,32.4],[1000,32.2],[1100,32.1],[1200,31.8],[1300,31.6],[1400,31.3],[1500,31.0],[1600,30.7],[1700,30.3],[1800,29.8],[1900,29.3],[2000,28.7],[2100,27.9],[2200,26.9],[2300,25.3]],
    3:[[400,27.3],[500,27.2],[600,27.1],[700,26.9],[800,26.7],[900,26.5],[1000,26.2],[1100,25.8],[1200,25.4],[1300,24.9],[1400,24.3],[1500,23.5],[1600,22.3],[1700,19.8]],
    2:[[300,23.5],[400,23.3],[500,23.2],[600,22.9],[700,22.7],[800,22.3],[900,21.8],[1000,21.3],[1100,20.4],[1200,19.2]],
    1:[[200,18.4],[300,18.2],[400,17.9],[500,17.5],[600,16.9],[700,16.0],[800,13.9]],
    0:[[50,14.1],[100,14.0],[150,13.9],[200,13.8],[250,13.6],[300,13.3],[350,12.9],[400,12.4],[450,11.4]]
  },
  "M821_HE": {
    4:[[400,36.3],[500,36.2],[600,36.2],[700,36.1],[800,36.0],[900,35.9],[1000,35.8],[1100,35.7],[1200,35.6],[1300,35.4],[1400,35.3],[1500,35.1],[1600,34.9],[1700,34.6],[1800,34.4],[1900,34.1],[2000,33.8],[2100,33.5],[2200,33.1],[2300,32.7],[2400,32.2],[2500,31.7],[2600,31.0],[2700,30.3],[2800,29.2],[2900,27.7]],
    3:[[300,31.7],[400,31.6],[500,31.6],[600,31.5],[700,31.4],[800,31.3],[900,31.1],[1000,31.0],[1100,30.8],[1200,30.6],[1300,30.3],[1400,30.1],[1500,29.7],[1600,29.4],[1700,29.0],[1800,28.5],[1900,28.0],[2000,27.3],[2100,26.5],[2200,25.3],[2300,22.7]],
    2:[[200,26.6],[300,26.5],[400,26.4],[500,26.3],[600,26.2],[700,26.0],[800,25.8],[900,25.5],[1000,25.2],[1100,24.9],[1200,24.4],[1300,23.9],[1400,23.2],[1500,22.3],[1600,20.9]],
    1:[[100,20.0],[200,19.9],[300,19.7],[400,19.5],[500,19.2],[600,18.8],[700,18.3],[800,17.5],[900,16.1]],
    0:[[50,13.2],[100,13.2],[150,13.0],[200,12.8],[250,12.6],[300,12.3],[350,11.7],[400,10.7]]
  }
};
/* ---------- helpers ---------- */
function updateRingsOptions(){
  const shell = document.getElementById('shellSelect').value;
  const sel = document.getElementById('ringsSelect');
  sel.innerHTML = '';
  const rings = Object.keys(ballisticTables[shell]).map(Number).sort((a,b)=>b-a);
  rings.forEach(r => { 
    const o = document.createElement('option'); 
    o.value=r; 
    o.textContent=r; 
    sel.appendChild(o); 
  });
}
updateRingsOptions();

function interpLinear(table,x){
  if(!table || table.length===0) return null;
  if (x <= table[0][0]) return table[0][1];
  if (x >= table[table.length-1][0]) return table[table.length-1][1];
  for(let i=0;i<table.length-1;i++){
    const [x0,y0]=table[i], [x1,y1]=table[i+1];
    if(x>=x0 && x<=x1){
      const t=(x-x0)/(x1-x0);
      return y0*(1-t)+y1*t; 
    }
  }
  return null;
}

function calculateDifference(){
  const player = parseFloat(document.getElementById('playerElev').value);
  const target = parseFloat(document.getElementById('targetElev').value);
  if(isNaN(player) || isNaN(target)){
    document.getElementById('elevDiffResult').textContent='Enter both elevations'; 
    return;
  }
  const diff = target - player;
  document.getElementById('elevDiffResult').textContent = `Elevation Difference: ${diff} m`;
}

/* Spread sync both ways */
function updateSpreadDisplay(from="slider"){
  if(from==="slider"){
    const val = parseFloat(document.getElementById('spreadRange').value);
    document.getElementById('spreadManual').value = val;
    document.getElementById('spreadDisplay').textContent = `Spread: ${val} m`;
  } else {
    const val = parseFloat(document.getElementById('spreadManual').value);
    document.getElementById('spreadRange').value = val;
    document.getElementById('spreadDisplay').textContent = `Spread: ${val} m`;
  }
}

function calculate(){
  const shell = document.getElementById('shellSelect').value;
  const rings = parseInt(document.getElementById('ringsSelect').value,10);
  const range = parseFloat(document.getElementById('rangeInput').value);
  const elevDiff = parseFloat(document.getElementById('elevDiffInput').value);
  const bearing = document.getElementById('bearingInput').value || "";
  const name = document.getElementById('nameInput').value || '';
  const totEnabled = document.getElementById('totToggle').checked;
  const spread = parseFloat(document.getElementById('spreadManual').value);
  const out = document.getElementById('output');
  const spreadOut = document.getElementById('spreadOutput');
  const totOut = document.getElementById('totOutput');
  totOut.innerHTML="";

  if(isNaN(range)||range<=0){out.textContent='Enter valid target range'; return;}
  const btab = ballisticTables[shell]?.[rings];
  if(!btab){out.textContent='No ballistic data'; return;}
  const baseMils = interpLinear(btab,range);

  const ctab = elevCorrectionTables[shell]?.[rings];
  let correctedMils = baseMils;
  if(!isNaN(elevDiff) && ctab){
    const per100 = interpLinear(ctab,range);
    if(per100!==null) correctedMils = baseMils + (elevDiff/100)*per100;
  }

  out.innerHTML = `Base elevation: <strong>${baseMils.toFixed(2)} mils</strong><br>Corrected elevation: <strong>${correctedMils.toFixed(2)} mils</strong>`;

  // Spread (clamped)
  const minRange = btab[0][0];
  const maxRange = btab[btab.length-1][0];
  const halfSpread = spread/2;
  const lowerRange = Math.max(minRange, range - halfSpread);
  const upperRange = Math.min(maxRange, range + halfSpread);
  const lowerMils = interpLinear(btab,lowerRange);
  const upperMils = interpLinear(btab,upperRange);
  spreadOut.innerHTML = `Suggested Mills for Spread (${spread} m): ${lowerMils.toFixed(2)} â ${upperMils.toFixed(2)}`;

  // TOT (baseline = selected rings)
  if(totEnabled){
    const tofs = [];
    for(const r in tofTables[shell]){
      const tof = interpLinear(tofTables[shell][r], range);
      const mils = interpLinear(ballisticTables[shell][r], range);
      if(tof && mils) tofs.push({rings:r, tof, mils});
    }
    if(tofs.length>1){
      const baseTOF = interpLinear(tofTables[shell][rings], range);
      let html = "<strong>TOT Solutions:</strong><br><table><tr><th>Rings</th><th>Mils</th><th>TOF (s)</th><th>Fire Delay (s)</th></tr>";
      tofs.forEach(t=>{
        const delay = (baseTOF - t.tof).toFixed(1);
        html += `<tr><td>${t.rings}</td><td>${t.mils.toFixed(2)}</td><td>${t.tof.toFixed(1)}</td><td>${delay>=0?delay:"+"+Math.abs(delay)}</td></tr>`;
      });
      html+="</table>";
      totOut.innerHTML = html;
    }
  }

  // History (limit 20 entries)
  const histTable = document.getElementById('historyTable').getElementsByTagName('tbody')[0];
  const row = histTable.insertRow();
  row.insertCell().textContent = name;
  row.insertCell().textContent = shell;
  row.insertCell().textContent = rings;
  row.insertCell().textContent = range;
  row.insertCell().textContent = bearing;
  row.insertCell().textContent = elevDiff;
  row.insertCell().textContent = correctedMils.toFixed(2);
  const delCell = row.insertCell();
  const delBtn = document.createElement('button');
  delBtn.textContent = 'Delete';
  delBtn.onclick = ()=>row.remove();
  delCell.appendChild(delBtn);

  // Remove oldest if >20
  while(histTable.rows.length > 20) histTable.deleteRow(0);
}

function resetView(){
  document.getElementById('rangeInput').value='';
  document.getElementById('elevDiffInput').value='';
  document.getElementById('output').textContent='';
  document.getElementById('spreadOutput').textContent='';
  document.getElementById('totOutput').textContent='';
}
</script>
</body>
</html>
